import os
import subprocess
import math
import time
import sys, string

samplesDir = os.getcwd()
samples = 0
for path in os.listdir(samplesDir):
    if os.path.isfile(os.path.join(samplesDir, path)):
        samples += 1
f = 0
s = 0
d = 0
m = 0
p = 0
c = input("Is real-time protection is turned on? ")
mname = ""
if (c == "yes"):
    print("Test succesfully started!")
else:
    exit()

for filename in os.listdir(samplesDir):
        file = (samplesDir, "\\", filename)
        subprocess.Popen(file, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
        time.sleep(3)
        p += 1
        print("Progress: ", math.floor(.5 + (p / samples)*100)," % done")
        if (subprocess.CalledProcessError):
            s += 1
            file = samplesDir+"\\"+filename
            print(file, "blocked!")
        else:
            m += 1
            file = samplesDir+"\\"+filename
            print(file, "missed!")
            missed = "\n" + samplesDir + "\\" + filename
            mname = mname + missed
        f += 1
        d = s / f
        print ("Pro-active detection: ",math.floor((100*d+.005)*100)/100, " %")

samplesLeft = 0
for path in os.listdir(samplesDir):
    if os.path.isfile(os.path.join(samplesDir, path)):
        samplesLeft += 1

AVRemovalRate = samplesLeft / samples
print("\n\nTest is completed. ", samples, " samples executed!")
d = s / samples
print ("Final Pro-active detection: ",math.floor((100*d+.005)*100)/100, " %", " Amount of samples missed: ", m)
print ("AntiMalware Quarrantine/Removal Rate: ",100-math.floor((100*AVRemovalRate+.005)*100)/100, " %")
if (mname != ""):
    print("\nSamples Missed:\n", mname)